# 営業日報システム テスト仕様書

## 1. テスト概要

### 1.1 目的
本テスト仕様書は、営業日報システムの品質を保証するためのテスト項目を定義する。

### 1.2 テスト範囲

| テスト種別 | 対象 | 概要 |
|-----------|------|------|
| 単体テスト | API・ビジネスロジック | 各機能の単体動作確認 |
| 結合テスト | API連携 | 複数機能の連携確認 |
| E2Eテスト | 画面操作 | ユーザー操作シナリオの確認 |

### 1.3 テスト環境

| 項目 | 内容 |
|------|------|
| テスト環境 | ステージング環境 |
| テストデータ | テスト用マスタデータ・シードデータ |
| ブラウザ | Chrome（最新版）、Safari（最新版） |

---

## 2. 単体テスト仕様

### 2.1 認証API

#### UT-AUTH-001: ログイン成功

| 項目 | 内容 |
|------|------|
| テストID | UT-AUTH-001 |
| テスト対象 | POST /api/v1/auth/login |
| 事前条件 | 有効なユーザーが存在する |
| テストデータ | email: "test@example.com", password: "password123" |
| 実行手順 | 1. 正しい認証情報でログインAPIを呼び出す |
| 期待結果 | ステータス200、JWTトークンが返却される |

#### UT-AUTH-002: ログイン失敗（パスワード誤り）

| 項目 | 内容 |
|------|------|
| テストID | UT-AUTH-002 |
| テスト対象 | POST /api/v1/auth/login |
| 事前条件 | 有効なユーザーが存在する |
| テストデータ | email: "test@example.com", password: "wrongpassword" |
| 実行手順 | 1. 誤ったパスワードでログインAPIを呼び出す |
| 期待結果 | ステータス401、INVALID_CREDENTIALSエラー |

#### UT-AUTH-003: ログイン失敗（存在しないユーザー）

| 項目 | 内容 |
|------|------|
| テストID | UT-AUTH-003 |
| テスト対象 | POST /api/v1/auth/login |
| 事前条件 | - |
| テストデータ | email: "notexist@example.com", password: "password123" |
| 実行手順 | 1. 存在しないメールアドレスでログインAPIを呼び出す |
| 期待結果 | ステータス401、INVALID_CREDENTIALSエラー |

#### UT-AUTH-004: ログイン失敗（無効ユーザー）

| 項目 | 内容 |
|------|------|
| テストID | UT-AUTH-004 |
| テスト対象 | POST /api/v1/auth/login |
| 事前条件 | is_active=false のユーザーが存在する |
| テストデータ | email: "inactive@example.com", password: "password123" |
| 実行手順 | 1. 無効化されたユーザーでログインAPIを呼び出す |
| 期待結果 | ステータス401、INVALID_CREDENTIALSエラー |

#### UT-AUTH-005: 自分の情報取得

| 項目 | 内容 |
|------|------|
| テストID | UT-AUTH-005 |
| テスト対象 | GET /api/v1/auth/me |
| 事前条件 | ログイン済み |
| テストデータ | - |
| 実行手順 | 1. 有効なトークンで自分の情報取得APIを呼び出す |
| 期待結果 | ステータス200、ログインユーザーの情報が返却される |

#### UT-AUTH-006: 認証エラー（トークンなし）

| 項目 | 内容 |
|------|------|
| テストID | UT-AUTH-006 |
| テスト対象 | GET /api/v1/auth/me |
| 事前条件 | - |
| テストデータ | Authorization ヘッダーなし |
| 実行手順 | 1. トークンなしでAPIを呼び出す |
| 期待結果 | ステータス401、認証エラー |

---

### 2.2 日報API

#### UT-REPORT-001: 日報一覧取得

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-001 |
| テスト対象 | GET /api/v1/daily-reports |
| 事前条件 | ログイン済み、日報データが存在する |
| テストデータ | - |
| 実行手順 | 1. 日報一覧取得APIを呼び出す |
| 期待結果 | ステータス200、日報一覧とページネーション情報が返却される |

#### UT-REPORT-002: 日報一覧取得（日付絞り込み）

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-002 |
| テスト対象 | GET /api/v1/daily-reports |
| 事前条件 | ログイン済み、複数日付の日報データが存在する |
| テストデータ | date_from: "2026-01-01", date_to: "2026-01-07" |
| 実行手順 | 1. 日付範囲を指定して日報一覧取得APIを呼び出す |
| 期待結果 | ステータス200、指定期間の日報のみ返却される |

#### UT-REPORT-003: 日報一覧取得（担当者絞り込み）

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-003 |
| テスト対象 | GET /api/v1/daily-reports |
| 事前条件 | ログイン済み（上長）、複数担当者の日報が存在する |
| テストデータ | sales_staff_id: 1 |
| 実行手順 | 1. 担当者IDを指定して日報一覧取得APIを呼び出す |
| 期待結果 | ステータス200、指定担当者の日報のみ返却される |

#### UT-REPORT-004: 日報詳細取得

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-004 |
| テスト対象 | GET /api/v1/daily-reports/:id |
| 事前条件 | ログイン済み、日報データが存在する |
| テストデータ | id: 1 |
| 実行手順 | 1. 日報詳細取得APIを呼び出す |
| 期待結果 | ステータス200、訪問記録・コメントを含む日報詳細が返却される |

#### UT-REPORT-005: 日報詳細取得（存在しないID）

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-005 |
| テスト対象 | GET /api/v1/daily-reports/:id |
| 事前条件 | ログイン済み |
| テストデータ | id: 99999 |
| 実行手順 | 1. 存在しないIDで日報詳細取得APIを呼び出す |
| 期待結果 | ステータス404、NOT_FOUNDエラー |

#### UT-REPORT-006: 日報作成成功

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-006 |
| テスト対象 | POST /api/v1/daily-reports |
| 事前条件 | ログイン済み、当日の日報が未作成 |
| テストデータ | report_date: "2026-01-08", visit_records: [{customer_id: 1, content: "テスト"}], problem: "課題", plan: "予定" |
| 実行手順 | 1. 日報作成APIを呼び出す |
| 期待結果 | ステータス201、日報が作成される |

#### UT-REPORT-007: 日報作成失敗（重複日付）

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-007 |
| テスト対象 | POST /api/v1/daily-reports |
| 事前条件 | ログイン済み、当日の日報が作成済み |
| テストデータ | report_date: "2026-01-08"（既存と同日） |
| 実行手順 | 1. 同一日付で日報作成APIを呼び出す |
| 期待結果 | ステータス409、DUPLICATE_REPORTエラー |

#### UT-REPORT-008: 日報作成失敗（訪問記録なし）

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-008 |
| テスト対象 | POST /api/v1/daily-reports |
| 事前条件 | ログイン済み |
| テストデータ | report_date: "2026-01-08", visit_records: [] |
| 実行手順 | 1. 訪問記録なしで日報作成APIを呼び出す |
| 期待結果 | ステータス400、VALIDATION_ERRORエラー |

#### UT-REPORT-009: 日報更新成功

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-009 |
| テスト対象 | PUT /api/v1/daily-reports/:id |
| 事前条件 | ログイン済み、自分の日報が存在する |
| テストデータ | problem: "更新された課題" |
| 実行手順 | 1. 自分の日報を更新APIで更新する |
| 期待結果 | ステータス200、日報が更新される |

#### UT-REPORT-010: 日報更新失敗（他人の日報）

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-010 |
| テスト対象 | PUT /api/v1/daily-reports/:id |
| 事前条件 | ログイン済み、他人の日報が存在する |
| テストデータ | id: 他人の日報ID |
| 実行手順 | 1. 他人の日報を更新APIで更新しようとする |
| 期待結果 | ステータス403、FORBIDDENエラー |

#### UT-REPORT-011: 日報削除成功

| 項目 | 内容 |
|------|------|
| テストID | UT-REPORT-011 |
| テスト対象 | DELETE /api/v1/daily-reports/:id |
| 事前条件 | ログイン済み、自分の日報が存在する |
| テストデータ | id: 自分の日報ID |
| 実行手順 | 1. 自分の日報を削除APIで削除する |
| 期待結果 | ステータス200、日報が削除される |

---

### 2.3 コメントAPI

#### UT-COMMENT-001: コメント追加成功（上長）

| 項目 | 内容 |
|------|------|
| テストID | UT-COMMENT-001 |
| テスト対象 | POST /api/v1/daily-reports/:id/comments |
| 事前条件 | 上長としてログイン済み、部下の日報が存在する |
| テストデータ | content: "テストコメント" |
| 実行手順 | 1. 部下の日報にコメント追加APIを呼び出す |
| 期待結果 | ステータス201、コメントが追加される |

#### UT-COMMENT-002: コメント追加失敗（権限なし）

| 項目 | 内容 |
|------|------|
| テストID | UT-COMMENT-002 |
| テスト対象 | POST /api/v1/daily-reports/:id/comments |
| 事前条件 | 一般営業としてログイン済み、他者の日報が存在する |
| テストデータ | content: "テストコメント" |
| 実行手順 | 1. 他者の日報にコメント追加APIを呼び出す |
| 期待結果 | ステータス403、FORBIDDENエラー |

#### UT-COMMENT-003: コメント削除成功

| 項目 | 内容 |
|------|------|
| テストID | UT-COMMENT-003 |
| テスト対象 | DELETE /api/v1/comments/:id |
| 事前条件 | 上長としてログイン済み、自分のコメントが存在する |
| テストデータ | id: 自分のコメントID |
| 実行手順 | 1. 自分のコメントを削除APIで削除する |
| 期待結果 | ステータス200、コメントが削除される |

---

### 2.4 顧客API

#### UT-CUSTOMER-001: 顧客一覧取得

| 項目 | 内容 |
|------|------|
| テストID | UT-CUSTOMER-001 |
| テスト対象 | GET /api/v1/customers |
| 事前条件 | ログイン済み、顧客データが存在する |
| テストデータ | - |
| 実行手順 | 1. 顧客一覧取得APIを呼び出す |
| 期待結果 | ステータス200、顧客一覧が返却される |

#### UT-CUSTOMER-002: 顧客一覧取得（名前検索）

| 項目 | 内容 |
|------|------|
| テストID | UT-CUSTOMER-002 |
| テスト対象 | GET /api/v1/customers |
| 事前条件 | ログイン済み、顧客データが存在する |
| テストデータ | name: "ABC" |
| 実行手順 | 1. 名前で絞り込んで顧客一覧取得APIを呼び出す |
| 期待結果 | ステータス200、名前に"ABC"を含む顧客のみ返却される |

#### UT-CUSTOMER-003: 顧客作成成功

| 項目 | 内容 |
|------|------|
| テストID | UT-CUSTOMER-003 |
| テスト対象 | POST /api/v1/customers |
| 事前条件 | 管理者としてログイン済み |
| テストデータ | name: "テスト株式会社", phone: "03-1234-5678" |
| 実行手順 | 1. 顧客作成APIを呼び出す |
| 期待結果 | ステータス201、顧客が作成される |

#### UT-CUSTOMER-004: 顧客作成失敗（権限なし）

| 項目 | 内容 |
|------|------|
| テストID | UT-CUSTOMER-004 |
| テスト対象 | POST /api/v1/customers |
| 事前条件 | 一般営業としてログイン済み |
| テストデータ | name: "テスト株式会社" |
| 実行手順 | 1. 顧客作成APIを呼び出す |
| 期待結果 | ステータス403、FORBIDDENエラー |

#### UT-CUSTOMER-005: 顧客更新成功

| 項目 | 内容 |
|------|------|
| テストID | UT-CUSTOMER-005 |
| テスト対象 | PUT /api/v1/customers/:id |
| 事前条件 | 管理者としてログイン済み、顧客が存在する |
| テストデータ | name: "更新株式会社" |
| 実行手順 | 1. 顧客更新APIを呼び出す |
| 期待結果 | ステータス200、顧客情報が更新される |

---

### 2.5 営業担当者API

#### UT-STAFF-001: 営業担当者一覧取得

| 項目 | 内容 |
|------|------|
| テストID | UT-STAFF-001 |
| テスト対象 | GET /api/v1/sales-staff |
| 事前条件 | 管理者としてログイン済み |
| テストデータ | - |
| 実行手順 | 1. 営業担当者一覧取得APIを呼び出す |
| 期待結果 | ステータス200、営業担当者一覧が返却される |

#### UT-STAFF-002: 営業担当者作成成功

| 項目 | 内容 |
|------|------|
| テストID | UT-STAFF-002 |
| テスト対象 | POST /api/v1/sales-staff |
| 事前条件 | 管理者としてログイン済み |
| テストデータ | name: "新人太郎", email: "shinjin@example.com", password: "password123" |
| 実行手順 | 1. 営業担当者作成APIを呼び出す |
| 期待結果 | ステータス201、営業担当者が作成される |

#### UT-STAFF-003: 営業担当者作成失敗（メール重複）

| 項目 | 内容 |
|------|------|
| テストID | UT-STAFF-003 |
| テスト対象 | POST /api/v1/sales-staff |
| 事前条件 | 管理者としてログイン済み、同一メールの担当者が存在 |
| テストデータ | email: "existing@example.com"（既存と同じ） |
| 実行手順 | 1. 重複メールで営業担当者作成APIを呼び出す |
| 期待結果 | ステータス409、DUPLICATE_EMAILエラー |

#### UT-STAFF-004: 営業担当者作成失敗（パスワード不足）

| 項目 | 内容 |
|------|------|
| テストID | UT-STAFF-004 |
| テスト対象 | POST /api/v1/sales-staff |
| 事前条件 | 管理者としてログイン済み |
| テストデータ | password: "short"（8文字未満） |
| 実行手順 | 1. 短いパスワードで営業担当者作成APIを呼び出す |
| 期待結果 | ステータス400、VALIDATION_ERRORエラー |

---

## 3. 結合テスト仕様

### IT-001: 日報作成〜コメント追加フロー

| 項目 | 内容 |
|------|------|
| テストID | IT-001 |
| テスト対象 | 日報作成からコメント追加までの一連フロー |
| 事前条件 | 営業担当者A、上長Bが存在する |
| 実行手順 | 1. 営業Aでログイン<br>2. 日報を作成（訪問記録2件）<br>3. ログアウト<br>4. 上長Bでログイン<br>5. 営業Aの日報を確認<br>6. コメントを追加 |
| 期待結果 | 日報作成、コメント追加が正常に完了する |

### IT-002: 日報更新〜訪問記録追加削除フロー

| 項目 | 内容 |
|------|------|
| テストID | IT-002 |
| テスト対象 | 日報更新と訪問記録の追加・削除 |
| 事前条件 | 営業担当者Aの日報（訪問記録2件）が存在する |
| 実行手順 | 1. 営業Aでログイン<br>2. 日報を取得<br>3. 訪問記録1件を更新<br>4. 訪問記録1件を削除<br>5. 訪問記録1件を追加<br>6. 日報を更新 |
| 期待結果 | 訪問記録が正しく更新・削除・追加される |

### IT-003: 顧客マスタ〜日報連携

| 項目 | 内容 |
|------|------|
| テストID | IT-003 |
| テスト対象 | 顧客マスタと日報の連携 |
| 事前条件 | 管理者、営業担当者が存在する |
| 実行手順 | 1. 管理者でログイン<br>2. 新規顧客を作成<br>3. ログアウト<br>4. 営業担当者でログイン<br>5. 新規顧客への訪問記録を含む日報を作成 |
| 期待結果 | 新規顧客を訪問先として日報が作成できる |

### IT-004: 営業担当者無効化の影響確認

| 項目 | 内容 |
|------|------|
| テストID | IT-004 |
| テスト対象 | 営業担当者無効化時の動作 |
| 事前条件 | 営業担当者A（日報あり）が存在する |
| 実行手順 | 1. 管理者でログイン<br>2. 営業Aを無効化（is_active=false）<br>3. ログアウト<br>4. 営業Aでログイン試行<br>5. 管理者で日報一覧を確認 |
| 期待結果 | 営業Aはログイン不可、過去の日報は閲覧可能 |

---

## 4. E2Eテスト仕様

### E2E-001: ログイン〜ダッシュボード表示

| 項目 | 内容 |
|------|------|
| テストID | E2E-001 |
| テスト対象 | SCR-001, SCR-002 |
| 事前条件 | 有効なユーザーが存在する |
| 実行手順 | 1. ログイン画面を開く<br>2. メールアドレス・パスワードを入力<br>3. ログインボタンをクリック |
| 期待結果 | ダッシュボード画面が表示される |

### E2E-002: ログイン失敗

| 項目 | 内容 |
|------|------|
| テストID | E2E-002 |
| テスト対象 | SCR-001 |
| 事前条件 | - |
| 実行手順 | 1. ログイン画面を開く<br>2. 誤ったパスワードを入力<br>3. ログインボタンをクリック |
| 期待結果 | エラーメッセージが表示される |

### E2E-003: 日報作成（正常系）

| 項目 | 内容 |
|------|------|
| テストID | E2E-003 |
| テスト対象 | SCR-011 |
| 事前条件 | ログイン済み、当日の日報未作成 |
| 実行手順 | 1. ダッシュボードの「作成」ボタンをクリック<br>2. 顧客を選択<br>3. 訪問内容を入力<br>4. 「+ 追加」で訪問記録を追加<br>5. 課題・相談を入力<br>6. 明日の予定を入力<br>7. 「保存」ボタンをクリック |
| 期待結果 | 日報が保存され、一覧画面に遷移する |

### E2E-004: 日報作成（訪問記録なしエラー）

| 項目 | 内容 |
|------|------|
| テストID | E2E-004 |
| テスト対象 | SCR-011 |
| 事前条件 | ログイン済み |
| 実行手順 | 1. 日報作成画面を開く<br>2. 訪問記録を入力せずに「保存」ボタンをクリック |
| 期待結果 | バリデーションエラーが表示される |

### E2E-005: 日報作成（重複日付エラー）

| 項目 | 内容 |
|------|------|
| テストID | E2E-005 |
| テスト対象 | SCR-011 |
| 事前条件 | ログイン済み、当日の日報作成済み |
| 実行手順 | 1. 日報作成画面を開く<br>2. 同じ日付で日報を作成しようとする |
| 期待結果 | 重複エラーが表示される |

### E2E-006: 日報編集

| 項目 | 内容 |
|------|------|
| テストID | E2E-006 |
| テスト対象 | SCR-012, SCR-013 |
| 事前条件 | ログイン済み、自分の日報が存在する |
| 実行手順 | 1. 日報詳細画面を開く<br>2. 「編集」ボタンをクリック<br>3. 訪問内容を変更<br>4. 「保存」ボタンをクリック |
| 期待結果 | 日報が更新され、詳細画面に遷移する |

### E2E-007: コメント追加（上長）

| 項目 | 内容 |
|------|------|
| テストID | E2E-007 |
| テスト対象 | SCR-013 |
| 事前条件 | 上長としてログイン済み、部下の日報が存在する |
| 実行手順 | 1. 部下の日報詳細画面を開く<br>2. コメント入力欄にコメントを入力<br>3. 「コメント送信」ボタンをクリック |
| 期待結果 | コメントが追加され、コメント一覧に表示される |

### E2E-008: 日報一覧検索

| 項目 | 内容 |
|------|------|
| テストID | E2E-008 |
| テスト対象 | SCR-010 |
| 事前条件 | ログイン済み、複数の日報データが存在する |
| 実行手順 | 1. 日報一覧画面を開く<br>2. 期間を指定<br>3. 「検索」ボタンをクリック |
| 期待結果 | 指定期間の日報のみ表示される |

### E2E-009: 顧客マスタ登録

| 項目 | 内容 |
|------|------|
| テストID | E2E-009 |
| テスト対象 | SCR-020, SCR-021 |
| 事前条件 | 管理者としてログイン済み |
| 実行手順 | 1. 顧客マスタ一覧画面を開く<br>2. 「新規登録」ボタンをクリック<br>3. 顧客情報を入力<br>4. 「保存」ボタンをクリック |
| 期待結果 | 顧客が登録され、一覧画面に遷移する |

### E2E-010: 顧客マスタ編集（無効化）

| 項目 | 内容 |
|------|------|
| テストID | E2E-010 |
| テスト対象 | SCR-021 |
| 事前条件 | 管理者としてログイン済み、顧客が存在する |
| 実行手順 | 1. 顧客マスタ一覧画面を開く<br>2. 「編集」ボタンをクリック<br>3. ステータスを「無効」に変更<br>4. 「保存」ボタンをクリック |
| 期待結果 | 顧客が無効化され、一覧でステータスが「無効」と表示される |

### E2E-011: 営業マスタ登録

| 項目 | 内容 |
|------|------|
| テストID | E2E-011 |
| テスト対象 | SCR-030, SCR-031 |
| 事前条件 | 管理者としてログイン済み |
| 実行手順 | 1. 営業マスタ一覧画面を開く<br>2. 「新規登録」ボタンをクリック<br>3. 営業担当者情報を入力<br>4. 上長を選択<br>5. 「保存」ボタンをクリック |
| 期待結果 | 営業担当者が登録され、一覧画面に遷移する |

### E2E-012: 営業マスタ登録（メール重複エラー）

| 項目 | 内容 |
|------|------|
| テストID | E2E-012 |
| テスト対象 | SCR-031 |
| 事前条件 | 管理者としてログイン済み、既存の営業担当者が存在する |
| 実行手順 | 1. 営業マスタ登録画面を開く<br>2. 既存と同じメールアドレスを入力<br>3. 「保存」ボタンをクリック |
| 期待結果 | メールアドレス重複エラーが表示される |

### E2E-013: ダッシュボード部下日報確認（上長）

| 項目 | 内容 |
|------|------|
| テストID | E2E-013 |
| テスト対象 | SCR-002 |
| 事前条件 | 上長としてログイン済み、部下が存在する |
| 実行手順 | 1. ダッシュボードを表示 |
| 期待結果 | 部下の日報状況一覧が表示される |

### E2E-014: ページネーション動作確認

| 項目 | 内容 |
|------|------|
| テストID | E2E-014 |
| テスト対象 | SCR-010 |
| 事前条件 | ログイン済み、21件以上の日報データが存在する |
| 実行手順 | 1. 日報一覧画面を開く<br>2. 「次へ」ボタンをクリック |
| 期待結果 | 2ページ目の日報一覧が表示される |

---

## 5. テストケースサマリー

| カテゴリ | テスト種別 | 件数 |
|---------|-----------|------|
| 認証 | 単体テスト | 6 |
| 日報 | 単体テスト | 11 |
| コメント | 単体テスト | 3 |
| 顧客 | 単体テスト | 5 |
| 営業担当者 | 単体テスト | 4 |
| 結合テスト | 結合テスト | 4 |
| E2Eテスト | E2Eテスト | 14 |
| **合計** | | **47** |

---

## 6. テスト実施記録

| テストID | 実施日 | 実施者 | 結果 | 備考 |
|----------|--------|--------|------|------|
| | | | | |

---

## 7. 不具合管理

| 不具合ID | テストID | 概要 | 重要度 | ステータス | 対応者 |
|----------|----------|------|--------|-----------|--------|
| | | | | | |
